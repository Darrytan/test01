<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itheima.dao.OrdersMapper">

    <!--  1.查询所有订单      -查订单的时候还需要将对应的产品信息查询出来-->
    <resultMap id="orders_product" type="com.itheima.pojo.Orders">
        <id property="id" column="oid"></id>
        <result property="orderNum" column="ORDERNUM"></result>
        <result property="orderTime" column="ORDERTIME"></result>
        <result property="orderStatus" column="ORDERSTATUS"></result>
        <!--一对一,一个订单详细包含一个产品信息名称和价格-->
        <association property="product" javaType="com.itheima.pojo.Product">
            <result property="productName" column="PRODUCTNAME"></result>
            <result property="productPrice" column="PRODUCTPRICE"></result>
        </association>
    </resultMap>
    <select id="findAll" resultMap="orders_product">
        select o.id oid,o.ordernum,p.productname,p.productprice,o.ordertime,o.orderstatus
      from ORDERS o left JOIN PRODUCT p on o.productid=p.id
    </select>


    <!--2. 根据订单id  查询订单详细信息, 订单与商品,游客信息,会员信息-->

    <resultMap id="orders_product_member_traveller" type="com.itheima.pojo.Orders">
        <!--orders表-->
        <id property="id" column="id"></id>
        <result property="orderNum" column="ORDERNUM"></result>
        <result property="orderTime" column="ORDERTIME"></result>
        <result property="peopleCount" column="PEOPLECOUNT"></result>
        <result property="orderDesc" column="ORDERDESC"></result>
        <result property="payType" column="PAYTYPE"></result>
        <result property="orderStatus" column="ORDERSTATUS"></result>
        <!--product表 一对一关系-->
        <association property="product"
                     column="PRODUCTID"
                     select="com.itheima.dao.ProductMapper.findProductById"
                     javaType="com.itheima.pojo.Product">
        </association>

        <!--member表 一对一关系-->
        <association property="member"
                     column="MEMBERID"
                     select="com.itheima.dao.MemberMapper.findMemberById"
                     javaType="com.itheima.pojo.Member">
        </association>

        <!--travellers表 多对多关系-->
        <collection property="travellers"
                    ofType="com.itheima.pojo.Traveller"
                    column="ID"
                    select="com.itheima.dao.TravellerMapper.findTravellerByOrderId">
        </collection>
    </resultMap>

    <!--根据订单id查询订单信息-->
    <select id="findOrderById" parameterType="String" resultMap="orders_product_member_traveller">
        SELECT * FROM ORDERS WHERE  ID = #{id}
    </select>

</mapper>